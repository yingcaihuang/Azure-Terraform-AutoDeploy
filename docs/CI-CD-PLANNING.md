# GitHub Actions CI/CD å®Œæ•´è§„åˆ’

## ğŸ“‹ é¡¹ç›®æ¦‚å†µ

æœ¬é¡¹ç›®å®ç°äº†ä½¿ç”¨ GitHub Actions + Terraform + Azure çš„å®Œæ•´è‡ªåŠ¨åŒ– CI/CD æµç¨‹ï¼Œç”¨äºç®¡ç† Azure Front Door å’Œç›¸å…³èµ„æºçš„éƒ¨ç½²ã€‚

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         GitHub Repository                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Git Workflow (åˆ†æ”¯ç®¡ç†)                         â”‚  â”‚
â”‚  â”‚  main (production)  â†  develop (staging)  â†  feature branches â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                     â”‚
â”‚                              â†“                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           GitHub Actions Workflows (è‡ªåŠ¨åŒ–)                 â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€ terraform-plan.yml â”€â”         â”Œâ”€ terraform-apply.yml â”€â”  â”‚
â”‚  â”‚  â”‚  è§¦å‘ï¼šPR åˆ›å»º        â”‚         â”‚  è§¦å‘ï¼šPush åˆ° main   â”‚  â”‚
â”‚  â”‚  â”‚  ä½œç”¨ï¼šéªŒè¯/é¢„è§ˆ      â”‚         â”‚  ä½œç”¨ï¼šéƒ¨ç½²èµ„æº       â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€ terraform-destroy.yml â”€â”€â”€â”€â”€â”€â”                   â”‚  â”‚
â”‚  â”‚  â”‚  è§¦å‘ï¼šæ‰‹åŠ¨è¿è¡Œï¼ˆworkflow_dispatchï¼‰ â”‚                   â”‚  â”‚
â”‚  â”‚  â”‚  ä½œç”¨ï¼šé”€æ¯èµ„æº                      â”‚                   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                     â”‚
â”‚                              â†“                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           Secrets & Credentials (å¯†é’¥ç®¡ç†)                  â”‚  â”‚
â”‚  â”‚  â€¢ AZURE_SUBSCRIPTION_ID (Azure è®¢é˜…)                      â”‚  â”‚
â”‚  â”‚  â€¢ AZURE_TENANT_ID (Azure ç§Ÿæˆ·)                            â”‚  â”‚
â”‚  â”‚  â€¢ AZURE_CLIENT_ID (Service Principal ID)                  â”‚  â”‚
â”‚  â”‚  â€¢ AZURE_CLIENT_SECRET (Service Principal å¯†é’¥)           â”‚  â”‚
â”‚  â”‚  â€¢ TENCENT_SECRET_ID (Tencent API Key - å¯é€‰)             â”‚  â”‚
â”‚  â”‚  â€¢ TENCENT_SECRET_KEY (Tencent API Key - å¯é€‰)            â”‚  â”‚
â”‚  â”‚  â€¢ SLACK_WEBHOOK (Slack é€šçŸ¥ - å¯é€‰)                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                     â”‚
â”‚                              â†“                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Microsoft Azure (éƒ¨ç½²ç›®æ ‡)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Resource Group (RG)                      â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€ Azure Front Door (CDN)     â”                           â”‚  â”‚
â”‚  â”‚  â”œâ”€ Origins (æºæœåŠ¡å™¨)         â”œâ”€ ç”± Terraform ç®¡ç†       â”‚  â”‚
â”‚  â”‚  â”œâ”€ Caching Rules (ç¼“å­˜è§„åˆ™)   â”¤                           â”‚  â”‚
â”‚  â”‚  â””â”€ Custom Domain (è‡ªå®šä¹‰åŸŸ)   â”˜                           â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   Tencent Cloud (DNS)                       â”‚  â”‚
â”‚  â”‚                    (å¯é€‰ï¼Œå¦‚ä½¿ç”¨ DNSPod)                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€ DNS Records (CNAME/TXT)                                â”‚  â”‚
â”‚  â”‚  â””â”€ DNS Verification (åŸŸåéªŒè¯)                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ æ ¸å¿ƒç»„ä»¶è¯´æ˜

### 1. GitHub Actions Workflowsï¼ˆä¸‰ä¸ªå·¥ä½œæµï¼‰

#### ğŸ”µ Terraform Plan (`terraform-plan.yml`)
- **è§¦å‘æ¡ä»¶ï¼š** PR åˆ›å»º/æ›´æ–°
- **æ‰§è¡Œç¯å¢ƒï¼š** Ubuntu Latest
- **ä¸»è¦æ­¥éª¤ï¼š**
  1. ä»£ç æ£€å‡º
  2. å®‰è£… Terraform
  3. æ ¼å¼æ£€æŸ¥ (`terraform fmt`)
  4. åˆå§‹åŒ– (`terraform init`)
  5. éªŒè¯é…ç½® (`terraform validate`)
  6. ç”Ÿæˆæ‰§è¡Œè®¡åˆ’ (`terraform plan`)
  7. åœ¨ PR ä¸­æ·»åŠ è¯„è®ºå±•ç¤ºè®¡åˆ’
- **è¾“å‡ºï¼š** Plan summaryã€PR è¯„è®º
- **å¤±è´¥å¤„ç†ï¼š** ç»§ç»­æ‰§è¡Œï¼Œä¸é˜»æ­¢æµç¨‹

#### ğŸŸ¢ Terraform Apply (`terraform-apply.yml`)
- **è§¦å‘æ¡ä»¶ï¼š** Push åˆ° main åˆ†æ”¯
- **æ‰§è¡Œç¯å¢ƒï¼š** Ubuntu Latestï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- **ä¸»è¦æ­¥éª¤ï¼š**
  1. ä»£ç æ£€å‡º
  2. å®‰è£… Terraform
  3. åˆå§‹åŒ– (`terraform init`)
  4. éªŒè¯é…ç½® (`terraform validate`)
  5. ç”Ÿæˆæ‰§è¡Œè®¡åˆ’ (`terraform plan`)
  6. åº”ç”¨è®¡åˆ’ (`terraform apply`)
  7. å¯¼å‡ºè¾“å‡º (`terraform output`)
  8. å‘é€ Slack é€šçŸ¥ï¼ˆå¯é€‰ï¼‰
- **è¾“å‡ºï¼š** éƒ¨ç½²æ‘˜è¦ã€èµ„æºè¾“å‡º
- **å¤±è´¥å¤„ç†ï¼š** ä¸­æ­¢æµç¨‹ï¼Œå‘é€é€šçŸ¥

#### ğŸ”´ Terraform Destroy (`terraform-destroy.yml`)
- **è§¦å‘æ¡ä»¶ï¼š** æ‰‹åŠ¨è¿è¡Œ (`workflow_dispatch`)
- **æ‰§è¡Œç¯å¢ƒï¼š** Ubuntu Latest
- **ä¸»è¦æ­¥éª¤ï¼š**
  1. ä»£ç æ£€å‡º
  2. å®‰è£… Terraform
  3. åˆå§‹åŒ– (`terraform init`)
  4. é”€æ¯èµ„æº (`terraform destroy`)
  5. å‘é€ Slack é€šçŸ¥ï¼ˆå¯é€‰ï¼‰
- **è¾“å‡ºï¼š** é”€æ¯æ‘˜è¦
- **å®‰å…¨æªæ–½ï¼š** éœ€è¦è¾“å…¥ "destroy" ç¡®è®¤

---

## ğŸ” å¯†é’¥ä¸å‡­è¯ç®¡ç†

### å¯†é’¥è·å–ä¸é…ç½®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å‡­è¯æ¥æº â†’ é…ç½®ä½ç½®                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Azure å‡­è¯ï¼š
  æºï¼šAzure CLI / Service Principal
  ä½ç½®ï¼šGitHub Secrets
  ç”¨é€”ï¼šè®¤è¯ Azure Provider
  
  AZURE_SUBSCRIPTION_ID   â† az account show --query id
  AZURE_TENANT_ID         â† Service Principal JSON
  AZURE_CLIENT_ID         â† Service Principal JSON
  AZURE_CLIENT_SECRET     â† Service Principal JSON

Tencent å‡­è¯ï¼ˆå¯é€‰ï¼‰ï¼š
  æºï¼šTencent Cloud Console
  ä½ç½®ï¼šGitHub Secrets
  ç”¨é€”ï¼šDNSPod API è®¤è¯
  
  TENCENT_SECRET_ID       â† Tencent CAM
  TENCENT_SECRET_KEY      â† Tencent CAM

Slack Webhookï¼ˆå¯é€‰ï¼‰ï¼š
  æºï¼šSlack App é…ç½®
  ä½ç½®ï¼šGitHub Secrets
  ç”¨é€”ï¼šéƒ¨ç½²é€šçŸ¥
  
  SLACK_WEBHOOK           â† Slack API
```

### ç¯å¢ƒå˜é‡æ˜ å°„

```
GitHub Secret          â†’  Terraform Environment  â†’  Terraform Variable
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
AZURE_SUBSCRIPTION_ID  â†’  ARM_SUBSCRIPTION_ID  â†’  var.subscription_id
AZURE_TENANT_ID        â†’  ARM_TENANT_ID
AZURE_CLIENT_ID        â†’  ARM_CLIENT_ID
AZURE_CLIENT_SECRET    â†’  ARM_CLIENT_SECRET
TENCENT_SECRET_ID      â†’  TF_VAR_tencent_secret_id
TENCENT_SECRET_KEY     â†’  TF_VAR_tencent_secret_key
```

---

## ğŸ“ æ–‡ä»¶ç»“æ„ä¸ç”¨é€”

```
project-root/
â”œâ”€â”€ .github/workflows/                    # GitHub Actions é…ç½®
â”‚   â”œâ”€â”€ terraform-plan.yml               # PR æ—¶è‡ªåŠ¨è¿è¡Œ Plan
â”‚   â”œâ”€â”€ terraform-apply.yml              # Push æ—¶è‡ªåŠ¨è¿è¡Œ Apply
â”‚   â””â”€â”€ terraform-destroy.yml            # æ‰‹åŠ¨é”€æ¯èµ„æº
â”‚
â”œâ”€â”€ env/                                  # ç¯å¢ƒé…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ dev.tfvars                       # å¼€å‘ç¯å¢ƒå˜é‡
â”‚   â”œâ”€â”€ prod.tfvars                      # ç”Ÿäº§ç¯å¢ƒå˜é‡
â”‚   â””â”€â”€ dns_test.tfvars                  # DNS æµ‹è¯•é…ç½®
â”‚
â”œâ”€â”€ modules/                              # Terraform æ¨¡å—
â”‚   â”œâ”€â”€ origins/                         # CDN æºé…ç½®æ¨¡å—
â”‚   â”œâ”€â”€ caching/                         # ç¼“å­˜è§„åˆ™æ¨¡å—
â”‚   â””â”€â”€ tencent_dns/                     # Tencent DNS æ¨¡å—
â”‚
â”œâ”€â”€ docs/                                 # æ–‡æ¡£ï¼ˆæ­¤æ¬¡æ–°å¢ï¼‰
â”‚   â”œâ”€â”€ QUICKSTART.md                    # å¿«é€Ÿå¼€å§‹æŒ‡å—
â”‚   â”œâ”€â”€ GITHUB-ACTIONS-SETUP.md          # è¯¦ç»†é…ç½®æŒ‡å—
â”‚   â”œâ”€â”€ ENVIRONMENT-SETUP.md             # ç¯å¢ƒè®¾ç½®æŒ‡å—
â”‚   â””â”€â”€ CI-CD-PLANNING.md                # æœ¬æ–‡ä»¶
â”‚
â”œâ”€â”€ main.tf                              # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ providers.tf                         # Provider é…ç½®
â”œâ”€â”€ variables.tf                         # å˜é‡å®šä¹‰
â”œâ”€â”€ outputs.tf                           # è¾“å‡ºå®šä¹‰
â”‚
â”œâ”€â”€ .gitignore                           # Git å¿½ç•¥è§„åˆ™ï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ *.tfstate                        # çŠ¶æ€æ–‡ä»¶
â”‚   â”œâ”€â”€ *.tfvars                         # å˜é‡æ–‡ä»¶
â”‚   â”œâ”€â”€ .terraform/                      # æœ¬åœ°ç¼“å­˜
â”‚   â””â”€â”€ backend.conf                     # åç«¯é…ç½®
â”‚
â””â”€â”€ README.md                            # é¡¹ç›®è¯´æ˜
```

---

## ğŸ”„ æ•°æ®æµä¸å·¥ä½œæµç¨‹

### å®Œæ•´å·¥ä½œæµç¤ºä¾‹

```
å¼€å‘è€… åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
   â”‚
   â”œâ”€ git checkout -b feature/update-cdn
   â”œâ”€ ä¿®æ”¹ env/prod.tfvars
   â”œâ”€ git add & commit & push
   â”‚
   â””â”€â†’ GitHub Push Event
       â”‚
       â””â”€â†’ ğŸ”µ Terraform Plan Workflow
           â”œâ”€ æ ¼å¼æ£€æŸ¥
           â”œâ”€ é…ç½®éªŒè¯
           â”œâ”€ ç”Ÿæˆ Plan
           â””â”€ PR è¯„è®ºå±•ç¤ºè®¡åˆ’
           
       å¼€å‘è€…åˆ›å»º PR

å¼€å‘è€… + Reviewers å®¡æŸ¥
   â”‚
   â”œâ”€ æŸ¥çœ‹ Terraform Plan è¯„è®º
   â”œâ”€ å®¡æŸ¥ä»£ç å˜æ›´
   â”œâ”€ è®¨è®ºå˜æ›´å†…å®¹
   â”‚
   â””â”€â†’ Approve & Merge

Merge åˆ° Main åˆ†æ”¯
   â”‚
   â””â”€â†’ GitHub Push Event (main branch)
       â”‚
       â””â”€â†’ ğŸŸ¢ Terraform Apply Workflow
           â”œâ”€ Terraform Init
           â”œâ”€ éªŒè¯é…ç½®
           â”œâ”€ ç”Ÿæˆ Plan
           â”œâ”€ æ‰§è¡Œ Apply
           â”œâ”€ åˆ›å»º/æ›´æ–° Azure èµ„æº
           â”œâ”€ å¯¼å‡ºè¾“å‡º
           â””â”€ å‘é€ Slack é€šçŸ¥ (å¦‚é…ç½®)

éƒ¨ç½²å®Œæˆ â†’ èµ„æºåœ¨ Azure ä¸­è¢«åˆ›å»º/æ›´æ–°
```

### å˜é‡æµå‘ç¤ºä¾‹

```
env/prod.tfvars (é…ç½®æ–‡ä»¶)
       â”‚
       â””â”€â†’ Terraform è¯»å–
           â”‚
           â”œâ”€â†’ resource_group_name = "rg-frontdoor-prod"
           â”œâ”€â†’ domain_name = "www.gslb.vip"
           â”œâ”€â†’ subscription_id = "00000000-0000-0000-0000-000000000000"
           â””â”€â†’ tencent_secret_id/key = "your-tencent-secret-*"
           
GitHub Secrets (æ¥è‡ªç¯å¢ƒ)
       â”‚
       â””â”€â†’ GitHub Actions ç¯å¢ƒå˜é‡
           â”‚
           â”œâ”€â†’ ARM_SUBSCRIPTION_ID
           â”œâ”€â†’ ARM_TENANT_ID
           â”œâ”€â†’ ARM_CLIENT_ID
           â”œâ”€â†’ ARM_CLIENT_SECRET
           â”œâ”€â†’ TF_VAR_tencent_secret_id
           â””â”€â†’ TF_VAR_tencent_secret_key
           
       â”‚
       â””â”€â†’ Terraform Provider è®¤è¯
           â”‚
           â””â”€â†’ è¿æ¥ Azure å¹¶éƒ¨ç½²èµ„æº
```

---

## ğŸ“Š éœ€è¦é…ç½®çš„ä¿¡æ¯æ¸…å•

### å¿…éœ€ä¿¡æ¯ï¼ˆğŸ”´ å¿…é…ç½®ï¼‰

| é¡¹ç›® | è·å–æ–¹å¼ | é…ç½®ä½ç½® | ç¤ºä¾‹ |
|------|--------|--------|------|
| Azure Subscription ID | `az account show --query id` | GitHub Secret | `00000000-0000-0000-0000-000000000000` |
| Azure Tenant ID | Service Principal JSON | GitHub Secret | `xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx` |
| Azure Client ID | Service Principal JSON | GitHub Secret | `xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx` |
| Azure Client Secret | Service Principal JSON | GitHub Secret | `xxxxxxx~xxxxxxxxxxxxxxxxxxxxxxxx` |
| å¼€å‘ç¯å¢ƒè®¢é˜… ID | ä» Azure | `env/dev.tfvars` | åŒä¸Š |
| å¼€å‘ç¯å¢ƒåŸŸå | ä½ çš„åŸŸå | `env/dev.tfvars` | `dev.example.com` |
| ç”Ÿäº§ç¯å¢ƒè®¢é˜… ID | ä» Azure | `env/prod.tfvars` | åŒä¸Š |
| ç”Ÿäº§ç¯å¢ƒåŸŸå | ä½ çš„åŸŸå | `env/prod.tfvars` | `example.com` |

### å¯é€‰ä¿¡æ¯ï¼ˆğŸŸ¡ å¯é…ç½®ï¼‰

| é¡¹ç›® | è·å–æ–¹å¼ | é…ç½®ä½ç½® | è¯´æ˜ |
|------|--------|--------|------|
| Tencent Secret ID | Tencent Cloud CAM | GitHub Secret | ä½¿ç”¨ Tencent DNS æ—¶éœ€è¦ |
| Tencent Secret Key | Tencent Cloud CAM | GitHub Secret | ä½¿ç”¨ Tencent DNS æ—¶éœ€è¦ |
| Slack Webhook | Slack App é…ç½® | GitHub Secret | éƒ¨ç½²å®Œæˆæ—¶é€šçŸ¥ |

---

## ğŸš€ å®æ–½æ­¥éª¤

### ç¬¬ä¸€é˜¶æ®µï¼šä»£ç å‡†å¤‡ï¼ˆå·²å®Œæˆï¼‰

- [x] åˆ›å»º GitHub Actions å·¥ä½œæµæ–‡ä»¶
- [x] åˆ›å»º .gitignore æ–‡ä»¶
- [x] æ›¿æ¢æ•æ„Ÿä¿¡æ¯ä¸ºå ä½ç¬¦
- [x] åˆ›å»ºæ–‡æ¡£

### ç¬¬äºŒé˜¶æ®µï¼šAzure å‡†å¤‡ï¼ˆç”¨æˆ·éœ€è¦åšï¼‰

- [ ] åˆ›å»º Azure Service Principal
- [ ] è·å– Subscription/Tenant/Client ID å’Œ Secret
- [ ] è®°å½•ç›¸å…³ä¿¡æ¯

### ç¬¬ä¸‰é˜¶æ®µï¼šGitHub é…ç½®ï¼ˆç”¨æˆ·éœ€è¦åšï¼‰

- [ ] åˆ›å»º GitHub Secretsï¼ˆ4 ä¸ª Azure + å¯é€‰çš„ Tencent/Slackï¼‰
- [ ] éªŒè¯ Secrets æ˜¯å¦è®¾ç½®æ­£ç¡®

### ç¬¬å››é˜¶æ®µï¼šç¯å¢ƒé…ç½®ï¼ˆç”¨æˆ·éœ€è¦åšï¼‰

- [ ] ç¼–è¾‘ `env/dev.tfvars` - æ›¿æ¢å®é™…å€¼
- [ ] ç¼–è¾‘ `env/prod.tfvars` - æ›¿æ¢å®é™…å€¼
- [ ] éªŒè¯é…ç½®æ–‡ä»¶

### ç¬¬äº”é˜¶æ®µï¼šæµ‹è¯•ï¼ˆç”¨æˆ·éœ€è¦åšï¼‰

- [ ] åˆ›å»º test åˆ†æ”¯ï¼Œè§¦å‘ Plan å·¥ä½œæµ
- [ ] å®¡æŸ¥ Plan è¾“å‡º
- [ ] åˆå¹¶åˆ° mainï¼Œè§¦å‘ Apply å·¥ä½œæµ
- [ ] éªŒè¯èµ„æºåœ¨ Azure ä¸­åˆ›å»ºæˆåŠŸ

---

## ğŸ” å˜é‡è¯¦è§£

### env/*.tfvars æ–‡ä»¶ä¸­çš„å˜é‡è¯´æ˜

```hcl
# Azure èµ„æºé…ç½®
resource_group_name = "rg-frontdoor-prod"     # èµ„æºç»„åç§°
location            = "eastus"                # Azure åœ°åŒº
afd_profile_name    = "afdprofile-prod"       # CDN Profile åç§°

# åŸŸåé…ç½®
domain_name         = "www.gslb.vip"          # è‡ªå®šä¹‰åŸŸå
dns_domain          = "gslb.vip"              # DNS æ ¹åŸŸ
dns_subdomain       = "www"                   # DNS å­åŸŸ

# è®¤è¯ä¿¡æ¯
subscription_id     = "00000000-..."          # Azure è®¢é˜…ï¼ˆå¿…éœ€ï¼‰
tencent_secret_id   = "your-secret-id"        # Tencent APIï¼ˆå¯é€‰ï¼‰
tencent_secret_key  = "your-secret-key"       # Tencent APIï¼ˆå¯é€‰ï¼‰

# æºæœåŠ¡å™¨é…ç½®
origin_host_name    = "www2.gslb.vip"         # æºæœåŠ¡å™¨åœ°å€
origin_host_header  = "www2.gslb.vip"         # æºè¯·æ±‚å¤´
origin_http_port    = 80                      # HTTP ç«¯å£
origin_https_port   = 443                     # HTTPS ç«¯å£
```

---

## âœ… éªŒè¯æ¸…å•

å®æ–½å®Œæˆåï¼ŒéªŒè¯ä»¥ä¸‹é¡¹ç›®ï¼š

### ä»£ç æ£€æŸ¥

- [ ] æ‰€æœ‰ `*.tfvars` æ–‡ä»¶ä¸­çš„æ•æ„Ÿä¿¡æ¯å·²æ›¿æ¢ä¸ºå ä½ç¬¦
- [ ] `.gitignore` åŒ…å«å¿…è¦çš„å¿½ç•¥è§„åˆ™
- [ ] æ²¡æœ‰ `.tfstate` æ–‡ä»¶åœ¨ä»“åº“ä¸­
- [ ] æ²¡æœ‰ `.terraform/` ç›®å½•åœ¨ä»“åº“ä¸­

### GitHub é…ç½®

- [ ] Repository ä¸ºç§æœ‰ä»“åº“ï¼ˆæ¨èï¼‰
- [ ] 4 ä¸ª Azure Secrets å·²æ·»åŠ 
- [ ] å¯é€‰ Secretsï¼ˆTencent/Slackï¼‰å·²æ·»åŠ ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] åˆ†æ”¯ä¿æŠ¤è§„åˆ™å·²å¯ç”¨
- [ ] Require pull request reviews å·²å¯ç”¨

### å·¥ä½œæµéªŒè¯

- [ ] terraform-plan.yml å­˜åœ¨å¹¶æœ‰æ•ˆ
- [ ] terraform-apply.yml å­˜åœ¨å¹¶æœ‰æ•ˆ
- [ ] terraform-destroy.yml å­˜åœ¨å¹¶æœ‰æ•ˆ
- [ ] å·¥ä½œæµæƒé™è®¾ç½®æ­£ç¡®

### ç¯å¢ƒéªŒè¯

- [ ] åˆ›å»º test PRï¼ŒTerraform Plan æˆåŠŸæ‰§è¡Œ
- [ ] Plan è¾“å‡ºæ­£ç¡®æ˜¾ç¤º
- [ ] åˆå¹¶ PRï¼ŒTerraform Apply æˆåŠŸæ‰§è¡Œ
- [ ] Azure èµ„æºåœ¨ Azure Portal ä¸­å¯è§
- [ ] èµ„æºä¸é…ç½®ç›¸ç¬¦

---

## ğŸ“ˆ å·¥ä½œæµç›‘æ§

### å…³é”®æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | ç›‘æ§æ–¹å¼ |
|------|------|--------|
| Plan æ‰§è¡Œæ—¶é—´ | < 2 åˆ†é’Ÿ | Actions æ—¥å¿— |
| Apply æ‰§è¡Œæ—¶é—´ | < 5 åˆ†é’Ÿ | Actions æ—¥å¿— |
| éƒ¨ç½²æˆåŠŸç‡ | 100% | Actions å†å² |
| èµ„æºåˆ›å»ºæ—¶é—´ | < 3 åˆ†é’Ÿ | Azure Portal |

### æ—¥å¿—æŸ¥çœ‹

```
GitHub Actions æ—¥å¿—ä½ç½®ï¼š
  ä»“åº“ â†’ Actions æ ‡ç­¾
  â†’ é€‰æ‹©å·¥ä½œæµ (terraform-plan/apply/destroy)
  â†’ é€‰æ‹©è¿è¡Œ
  â†’ æŸ¥çœ‹æ­¥éª¤å’Œæ—¥å¿—
```

---

## ğŸ” å®‰å…¨æœ€ä½³å®è·µ

### Secrets ç®¡ç†

1. **å®šæœŸè½®æ¢å‡­è¯**
   - æ¯ 90 å¤©æ›´æ–°ä¸€æ¬¡ Service Principal
   - ç«‹å³æ›´æ–° GitHub Secrets
   - åˆ é™¤æ—§å‡­è¯

2. **æƒé™æœ€å°åŒ–**
   - Service Principal ä»…èµ‹äºˆå¿…è¦æƒé™
   - ä½¿ç”¨èµ„æºç»„çº§åˆ«çš„ Contributor è€Œéè®¢é˜…çº§åˆ«

3. **å®¡è®¡å’Œç›‘æ§**
   - å¯ç”¨ GitHub å®¡è®¡æ—¥å¿—
   - å¯ç”¨ Azure æ´»åŠ¨æ—¥å¿—
   - ç›‘æ§å¼‚å¸¸éƒ¨ç½²

### ä»£ç å®‰å…¨

1. **ç‰ˆæœ¬æ§åˆ¶**
   - æ‰€æœ‰å˜æ›´é€šè¿‡ Git è®°å½•
   - ä½¿ç”¨ commit message è®°å½•åŸå› 

2. **ä»£ç å®¡æŸ¥**
   - æ‰€æœ‰å˜æ›´é€šè¿‡ PR å®¡æŸ¥
   - è‡³å°‘ä¸€ä¸ª approver æ‰èƒ½åˆå¹¶

3. **æ•æ„Ÿä¿¡æ¯**
   - ä¸æäº¤å¯†é’¥ã€å¯†ç ã€ä»¤ç‰Œ
   - ä½¿ç”¨ GitHub Secrets ç®¡ç†æ•æ„Ÿä¿¡æ¯
   - ä½¿ç”¨ tfstate è¿œç¨‹åç«¯ï¼ˆä¸æäº¤æœ¬åœ°çŠ¶æ€ï¼‰

---

## ğŸ“ æ¨èçš„åç»­ä¼˜åŒ–

### çŸ­æœŸï¼ˆ1-2 å‘¨ï¼‰

- [ ] é…ç½®è¿œç¨‹ Terraform åç«¯ï¼ˆAzure Storageï¼‰
- [ ] æ·»åŠ  terraform.lock ç‰ˆæœ¬é”å®š
- [ ] å®ç°å¤šç¯å¢ƒéƒ¨ç½²ï¼ˆdev/staging/prodï¼‰
- [ ] æ·»åŠ èµ„æºæ ‡ç­¾è‡ªåŠ¨åŒ–

### ä¸­æœŸï¼ˆ1-2 æœˆï¼‰

- [ ] å®ç°è“ç»¿éƒ¨ç½²ç­–ç•¥
- [ ] æ·»åŠ è‡ªåŠ¨å›æ»šæœºåˆ¶
- [ ] å®ç°æˆæœ¬ç›‘æ§å‘Šè­¦
- [ ] æ·»åŠ æ›´è¯¦ç»†çš„éƒ¨ç½²æ—¥å¿—

### é•¿æœŸï¼ˆ3-6 æœˆï¼‰

- [ ] è¿ç§»åˆ° Terraform Cloud/Enterprise
- [ ] å®ç° GitOps å®Œæ•´æµç¨‹
- [ ] æ·»åŠ åˆè§„æ€§æ£€æŸ¥
- [ ] å®ç° Terraform æ¨¡å—åŒ–å’Œå¤ç”¨

---

## ğŸ“ æ”¯æŒå’Œæ–‡æ¡£

### ç›¸å…³æ–‡æ¡£

- [å¿«é€Ÿå¼€å§‹æŒ‡å—](QUICKSTART.md) - 5 åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹
- [è¯¦ç»†é…ç½®æŒ‡å—](GITHUB-ACTIONS-SETUP.md) - è¯¦ç»† Secrets é…ç½®
- [ç¯å¢ƒè®¾ç½®æŒ‡å—](ENVIRONMENT-SETUP.md) - ç¯å¢ƒå˜é‡é…ç½®è¯¦è§£

### å¸¸è§é—®é¢˜

è¯¦è§å„æ–‡æ¡£çš„ FAQ éƒ¨åˆ†ã€‚

### è·å–å¸®åŠ©

1. æŸ¥çœ‹ Actions æ—¥å¿—äº†è§£å…·ä½“é”™è¯¯
2. æ£€æŸ¥ .gitignore å’Œæ–‡ä»¶æ˜¯å¦æ­£ç¡®
3. éªŒè¯ Secrets æ˜¯å¦æ­£ç¡®é…ç½®
4. åœ¨æœ¬åœ°è¿è¡Œ terraform validate éªŒè¯é…ç½®

---

**æœ€åæ›´æ–°ï¼š** 2025-12-25  
**ç‰ˆæœ¬ï¼š** 1.0  
**ä½œè€…ï¼š** GitHub Copilot
